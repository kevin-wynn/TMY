function errorCB(a){console.log("error")}var prefixUrl=window.location.pathname.slice(0,-1),offset=0,limit=4;$(document).ready(function(){function a(a){theMovieDb.movies.getById({id:a},function(b){var c=$.parseJSON(b).imdb_id,d="http://www.imdb.com/title/",e=d+c,f=$('[data-movie-id="'+a+'"]');f.wrap('<a target="_blank" href="'+e+'"></a>')},errorCB)}var b=$("#heroImage"),c=$("#movieTitle"),d=$("#movieOverview"),e=$("#movieGenres"),f=$("#movieScore"),g=$("#movieDirector"),h=$("#movieCast"),j=$("#seeReview"),k=0;$.ajax({type:"GET",url:"php/heroImage.php",dataType:"json",success:function(a){function l(a){var b=$.parseJSON(a).name;k==t.length?h.append(b):h.append(b+", ")}var m=prefixUrl+a[0].backdrop_path,n=a[0].movie_id,o=a[0].movie_title,p=a[0].genre,q=a[0].overview,r=a[0].score,s=a[0].director,t=a[0].cast,u=o.replace(/\s+/g,"-").toLowerCase(),v=n,w=prefixUrl+"/movies/"+u+"?movie_id="+v;for(b.css("background-image","url("+m+")"),$(".footer").css("background-image","url("+m+")"),c.html('<span data-movie-id="'+n+'" class="featured-title">'+o+"</span>"),e.html(p),d.html(q),h.html(t),g.html('<span class="intro-text">Directed By - </span>'+s),h.html('<span class="intro-text">Starring - </span>'),t=t.replace(/ /g,""),t=t.split(","),i=0;i<t.length;i++)theMovieDb.people.getById({id:t[i]},l,errorCB);for(i=0;i<r;i++)f.append('<i class="fa fa-star"></i> ');j.append('<span class="see-review"><a href="'+w+'">See Review</a></span>')}}),$.ajax({type:"GET",url:"php/moviesReviewed.php",dataType:"json",data:{offset:0,limit:8},success:function(a){var b="";for($("#homeRecentMovies").html(""),i=0;i<a.length;i++){var c,d=prefixUrl+a[i].poster_path,e=a[i].movie_title,f=a[i].genre,g=a[i].overview,h=a[i].score,j=a[i].director,k=a[i].publish_date,l=a[i].release_date,m=a[i].movie_id,n=e.replace(/\s+/g,"-").toLowerCase(),o=m,p=prefixUrl+"/movies/"+n+"?movie_id="+o,q=f.replace(/,/g,"");if(q=q.toLowerCase(),q.indexOf("science fiction")>-1){q=q.split(" ");var r=$.inArray("science",q),s=q[r]+"-"+q[r+1];q.splice(r+1,1),q.splice(r,1),q.push(s),q=q.toString(),q=q.replace(/,/g," ")}b+=q+" ",d='<div class="poster"><img src="'+d+'"/></div>',e='<h2 id="movie_title">'+e+"</h2>",f='<p id="genres">'+f+"</p>",g="<p>"+g+"</p>",j='<p><span class="intro-text">Directed By - </span>'+j+"</p>",c='<div class="score">',c+='<i class="fa fa-star"><span class="rating-number">'+h+"</span></i></div>",fullItems='<div data-released="'+l+'" data-movie-id="'+m+'" data-published="'+k+'" data-category="'+q+'" class="recent-item recent-reviewed col-md-3" id="movie"><a href="'+p+'">'+d+'<div class="col-md-10 info">'+e+f+j+'</div><div class="col-md-2 score-container">'+c+"</div></a></div>",$("#homeRecentMovies").append(fullItems)}b=b.split(" "),b=$.unique(b),b.pop(),initControls()}}),$.ajax({type:"GET",url:"php/discovery.php",dataType:"json",success:function(b){for($("#homeDiscover").html(""),i=0;i<b.length;i++){var c=prefixUrl+b[i].poster_path,d=b[i].movie_title,e=b[i].genre,f=b[i].overview,g=(b[i].score,b[i].director),h=(b[i].publish_date,b[i].release_date),j=b[i].moviedb_id,k=e.replace(/,/g,"");k=k.toLowerCase(),c='<div data-movie-id="'+j+'" class="poster"><img src="'+c+'"/></div>',d='<h2 id="movie_title">'+d+"</h2>",e='<p id="genres">'+e+"</p>",f="<p>"+f+"</p>",g='<p><span class="intro-text">Directed By - </span>'+g+"</p>",fullItems=$('<div data-released="'+h+'" class="recent-item col-md-3 col-sm-6 col-xs-6 '+k+'" id="discovery">'+c+"</div>"),$("#homeDiscover").append(fullItems),a(j)}initControls()}}),$.ajax({type:"GET",url:"php/nowplaying.php",dataType:"json",success:function(b){for($("#homeNowplaying").html(""),i=0;i<b.length;i++){var c=prefixUrl+b[i].poster_path,d=b[i].movie_title,e=b[i].genre,f=b[i].overview,g=(b[i].score,b[i].director),h=(b[i].publish_date,b[i].release_date),j=b[i].moviedb_id,k=e.replace(/,/g,"");k=k.toLowerCase(),c='<div data-movie-id="'+j+'" class="poster"><img src="'+c+'"/></div>',d='<h2 id="movie_title">'+d+"</h2>",e='<p id="genres">'+e+"</p>",f="<p>"+f+"</p>",g='<p><span class="intro-text">Directed By - </span>'+g+"</p>",fullItems=$('<div data-released="'+h+'" class="recent-item col-md-3 col-sm-6 col-xs-6 '+k+'" id="nowplaying">'+c+"</div>"),$("#homeNowplaying").append(fullItems),a(j)}initControls()}}),$.ajax({type:"GET",url:"php/homeFeatureNowPlaying.php",dataType:"json",success:function(a){function b(a){$("#featuredNowPlayingGenres");theMovieDb.genres.getList({},function(b){for(b=$.parseJSON(b).genres,i=0;i<b.length;++i)b[i].id==a[i]},errorCB)}for($("#featuredNowPlaying").html(""),i=0;i<a.length;i++){var c=prefixUrl+a[i].poster_path,d=a[i].movie_title,e=a[i].genre,f=a[i].overview,g=(a[i].score,a[i].director),h=(a[i].publish_date,a[i].release_date),j=a[i].moviedb_id;for(e=e.split(","),i=0;i<e.length;i++)e[i]=parseInt(e[i],10);c='<div data-movie-id="'+j+'" class="poster"><img src="'+c+'"/></div>',d='<h2 id="movie_title">'+d+"</h2>",genres_container='<p id="featuredNowPlayingGenres"></p>',f="<p>"+f+"</p>",g='<p><span class="intro-text">Directed By - </span>'+g+"</p>",fullItems='<div data-released="'+h+'" class="col-md-4 featured-now-playing recent-item" id="nowplaying">'+c+'</div><div class="col-md-8">'+d+genres_container+f+g+"</div>",$("#featuredNowPlaying").html(fullItems),b(e)}}})});